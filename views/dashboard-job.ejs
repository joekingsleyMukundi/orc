<%- include('./includes/headers.ejs') %>

<script>
    // Helper function to calculate time ago
    function timeAgo(date) {
        const now = new Date();
        const diffMs = now - new Date(date); // difference in milliseconds
        const diffMins = Math.floor(diffMs / 60000); // convert to minutes
        if (diffMins < 60) return `${diffMins} min ago`;
        const diffHours = Math.floor(diffMins / 60);
        if (diffHours < 24) return `${diffHours} hr ago`;
        const diffDays = Math.floor(diffHours / 24);
        return `${diffDays} days ago`;
    }
</script>

    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">
        <div class="page-content">
            <div class="container-fluid">

                <div class="row mb-4">
                    <div class="col-lg-12">
                        <div class="d-flex align-items-center">
                            <img src="assets/images/users/avatar-1.jpg" alt="" class="avatar-sm rounded">
                            <div class="ms-3 flex-grow-1">
                                <h5 class="mb-2 card-title">Hello, <%= user.fullname %>
                                </h5>
                                <p class="text-muted mb-0">Ready to jump back in?</p>
                            </div>
                            <% if (message.length> 0) { %>
                                <div class="alert alert-danger text-center mb-4" role="alert">
                                    <%= message[0]%>.
                                </div>
                            <% } %>
                            <% if (user.email==="buffastrologer@gmail.com" ) { %>
                                <div>
                                    <a href="javascript:void(0);" class="btn btn-primary" onclick="toggleForm()">
                                        <i class="bx bx-plus align-middle"></i> Add New Jobs
                                    </a>
                                </div>
                                <% } %>

                        </div>
                    </div><!--end col-->
                </div><!--end row-->

                <!-- Form container with hidden style initially -->
                <div id="jobFormContainer" style="display: none; margin-top: 20px;">
                    <form action="/jobs/add" method="POST">
                        <div class="mb-3">
                            <label for="formrow-accountname-input" class="form-label">Account Name</label>
                            <input type="text" class="form-control" name="name" id="formrow-accountname-input"
                                placeholder="Enter Account Name" required>
                        </div>

                        <div class="mb-3">
                            <label for="formrow-location-input" class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" id="formrow-location-input"
                                placeholder="Enter Location" required>
                        </div>

                        <div class="mb-3">
                            <label for="formrow-subject-input" class="form-label">Subject</label>
                            <input type="text" class="form-control" name="subject" id="formrow-subject-input"
                                placeholder="Enter Subject" required>
                        </div>

                        <div class="mb-3">
                            <label for="formrow-price-input" class="form-label">Price</label>
                            <input type="number" class="form-control" name="price" id="formrow-price-input" placeholder="Enter Price"
                                min="0" required>
                        </div>

                        <div class="mb-3">
                            <label for="formrow-imageurl-input" class="form-label">Image URL</label>
                            <input type="url" class="form-control" name="image" id="formrow-imageurl-input"
                                placeholder="Enter Image URL" required>
                        </div>

                        <div>
                            <button type="submit" class="btn btn-primary w-md">Submit</button>
                        </div>
                    </form>
                </div>

                <script>
                    // Function to toggle the form visibility
                    function toggleForm() {
                        const formContainer = document.getElementById("jobFormContainer");
                        formContainer.style.display = formContainer.style.display === "none" ? "block" : "none";
                    }
                </script>

                <div class="row">
                    <div class="col-lg-4">
                        <div class="card mini-stats-wid">
                            <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Writing Accounts</p>
                                        <h4 class="mb-0">
                                            <%= accounts.length %>
                                        </h4>
                                    </div>

                                    <div class="flex-shrink-0 align-self-center">
                                        <div data-colors='["--bs-success", "--bs-transparent"]' dir="ltr"
                                            id="eathereum_sparkline_charts"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body border-top py-3">
                                <p class="mb-0"> <span class="badge badge-soft-success me-1"><i
                                            class="bx bx-trending-up align-bottom me-1"></i> 18.89%</span> Increase last
                                    month</p>
                            </div>
                        </div>
                    </div><!--end col-->
                    <div class="col-lg-4">
                        <div class="card mini-stats-wid">
                            <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">My Accounts</p>
                                        <h4 class="mb-0">
                                            <%= jobs.accounts.length %>
                                        </h4>
                                    </div>

                                    <div class="flex-shrink-0 align-self-center">
                                        <div data-colors='["--bs-success", "--bs-transparent"]' dir="ltr"
                                            id="new_application_charts"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body border-top py-3">
                                <p class="mb-0"> <span class="badge badge-soft-success me-1"><i
                                            class="bx bx-trending-up align-bottom me-1"></i> 24.07%</span> Increase last
                                    month</p>
                            </div>
                        </div>
                    </div><!--end col-->
                    <div class="col-lg-4">
                        <div class="card mini-stats-wid">
                            <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Processing Acc</p>
                                        <h4 class="mb-0">
                                            <%= jobs.paccounts.length %>
                                        </h4>
                                    </div>

                                    <div class="flex-shrink-0 align-self-center">
                                        <div data-colors='["--bs-success", "--bs-transparent"]' dir="ltr"
                                            id="total_approved_charts"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body border-top py-3">
                                <p class="mb-0"> <span class="badge badge-soft-success me-1"><i
                                            class="bx bx-trending-up align-bottom me-1"></i> 8.41%</span> Increase last
                                    month</p>
                            </div>
                        </div>
                    </div><!--end col-->
                </div><!--end row-->

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">My Accounts</h4>
                                <div data-simplebar style="max-height: 476px;">
                                    <div class="vstack gap-4">
                                        <% myaccounts.forEach(account=> { %>
                                            <div class="d-flex">
                                                <img src="<%= account.image %>" alt="" height="40" class="rounded">
                                                <div class="ms-2 flex-grow-1">
                                                    <h6 class="mb-1 font-size-15">
                                                        <%= account.name %>
                                                    </h6>
                                                    <p class="text-muted mb-0">
                                                        <%= account.subject %>, <%= account.location %> -
                                                                <span>
                                                                    <script>document.write(timeAgo('<%= account.createdAt %>'));</script>
                                                                </span>
                                                    </p>
                                                    <p class="text-muted mb-0">Price: <b>
                                                            <%= account.price %>
                                                        </b> USD</p>
                                                </div>
                                                <span >
                                                    <%= account.status==='Sold' ? 'Sold' : 'Processing' %>
                                                </span>
                                                
                                            </div>
                                            <% }) %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!--end col-->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Accounts For Sale</h4>
                                <div data-simplebar style="max-height: 476px;">
                                    <div class="vstack gap-4">
                                        <% accounts.forEach(account=> { %>
                                            <div class="d-flex">
                                                <img src="<%= account.image %>" alt="" height="40" class="rounded">
                                                <div class="ms-2 flex-grow-1">
                                                    <h6 class="mb-1 font-size-15">
                                                        <%= account.name %>
                                                    </h6>
                                                    <p class="text-muted mb-0">
                                                        <%= account.subject %>, <%= account.location %> -
                                                                <span>
                                                                    <script>document.write(timeAgo('<%= account.createdAt %>'));</script>
                                                                </span>
                                                    </p>
                                                    <p class="text-muted mb-0">Price: <b>
                                                            <%= account.price %>
                                                        </b> USD</p>
                                                </div>
                                                <a href="/jobs/buy/<%= account._id %>" class="text-success me-2" title="Order">
                                                    <i class="bx bx-cart-alt" style="font-size: 20px;"></i>
                                                </a>
                                                <a href="/jobs/delete/<%= account._id %>" class="text-danger" title="Delete">
                                                    <i class="bx bx-trash" style="font-size: 20px;"></i>
                                                </a>
                                            </div>
                                            <% }) %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!--end col--><!--end col-->
<!--end col-->
                </div><!--end row-->

            </div> <!-- container-fluid -->
        </div>
        <!-- End Page-content -->

        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <script>document.write(new Date().getFullYear())</script> © LuxurPay.
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-end d-none d-sm-block">
                            Design & Develop by JK M
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <%- include('./includes/footer.ejs') %>
